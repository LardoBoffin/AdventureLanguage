10VDU23;8202;0;0;0;:DIM W% 40:DIM CI% 520T%=0:Q%=030SW%=040SC%=050REPEAT60PRINT "Loading data.";:PROCldOb("DATA-O")70IF T%=0 THEN PROCgW(1):PROCgW(2):PROCgW(4):PROCldSM80MODE 7:PRINT:PRINTCHR$(131);CHR$(141);TAB(5)"Ransom2":PRINTCHR$(131);CHR$(141);TAB(5)"Ransom2"90PROCvars:DIM CTR% 7:FOR X%=1 TO 7:PROCset(X%,0):NEXT100R%=1:OLR%=0:T%=0:PL%=10000:EX%=0:ENC%=0:CW%=0:L%=0:PROCinit110PRINT TAB(0,5)"Press";CHR$(131);"1";CHR$(135);"to start a new game":PRINT TAB(0,7)"Press"CHR$(131);"2";CHR$(135);"to continue an existing game":PRINT:PRINT">";:REPEAT:C$=INKEY$(0):UNTIL C$="1" OR C$="2":CLS120IF C$="2" THEN PRINTTAB(10,0)CHR$(131);"Getting catalogue...":PRINT:*CAT130IF C$="2" THEN PRINT:PRINT"Type the file name and press Enter":PRINT"Or press Enter for the default save":INPUT">" CMD$:IF LEFT$(CMD$,2)="S." THEN CMD$=RIGHT$(CMD$,LEN(CMD$)-2)140IF C$="2" THEN CMD$="LOAD "+CMD$:CLS:PROCload150REPEAT:D%=RND(100):PROCpreRoom:IF R%<>OLR% THEN OLR%=R%:PROCcl:PROCgtRm(R%):PROCt160D%=FNhighPty:IF EX%=0 AND NOT D% THEN PROCpsTxt170IF V%=0 AND EX%=0 AND NOT D% THEN PROCmsg(4):D%=TRUE180IF EX%=0 AND NOT D% THEN D%=FNckMv:IF NOT D% THEN D%=FNlowPty:IF V%>0 AND NOT D% THEN PROCmsg(3)190IF SC%=1 PROCshowC200CL%=0:D%=0:UNTIL EX%=1:UNTIL FNagain=FALSE210PRINT "Thanks for playing...":END220DEFPROCshowC:LOCAL X%230PRINT:FOR X%=1 TO 7:PRINT X%,FNget(X%):NEXT:240ENDPROC250DEFPROCshowParse260PRINT:PRINT "Verb",V%270PRINT "Adverb",AVRB%280PRINT "Noun",N%290PRINT "Last Noun",L%300PRINT "Noun2",NO2%:PRINT310ENDPROC320DEFPROCcl:IF Q%=1 THEN CLS330ENDPROC340DEFFNagain:LOCAL A$:PRINT "":INPUT "Another game? (Y/N)";A$:IF A$="Y" OR A$="y" THEN =TRUE ELSE =FALSE350DEFPROCsave:LOCAL F%,X%,N$:N$=LEFT$(MID$(CMD$,6),7):IF N$="" THEN N$="SAVE-M"360PRINT"Saving...":F%=OPENOUT(N$):PRINT#F%,T%,R%,ENC%,CW%,Q%:FOR X%=1 TO 7:BPUT#F%,?(CTR%+X%):NEXT:IF OBJN%>0 THEN FOR X%=1 TO OBJN%*8:BPUT#F%,?(OB%+X%):NEXT370CLOSE#F%:PROCe:PRINT"Done.":ENDPROC380DEFPROCload:LOCAL F%,X%,N$:N$=LEFT$(MID$(CMD$,6),7):IF N$="" THEN N$="SAVE-M"390PRINT"Loading...":F%=OPENIN(N$):INPUT#F%,T%,R%,ENC%,CW%,Q%:FOR X%=1 TO 7:?(CTR%+X%)=BGET#F%:NEXT:IF OBJN%>0 THEN FOR X%=1 TO OBJN%*8:?(OB%+X%)=BGET#F%:NEXT400CLOSE#F%:PROCe:PRINT"Done.":ENDPROC410DEFPROCldSM:LOCAL N%,R%,F%:F%=OPENIN("DATA-M"):DIM MS$(40):FOR X%=1 TO 40:PRINT".";:PTR#F%=FNrdIx(X%,"IDX-M"):INPUT#F%,MS$(X%):NEXT:CLOSE#F%:ENDPROC420DEFPROCldOb(F$):LOCAL N%,R%,T%:F%=OPENIN(F$):R%=0:REPEAT:FOR X%=1TO8:N%=BGET#F%:NEXT:R%=R%+1:PRINT".";:UNTIL EOF#F%:PTR#F%=0:OBJN%=R%:R%=R%*8430IF FNturn=0 THEN DIM OB% R%440R%=1:REPEAT:?(OB%+R%)=BGET#F%:R%=R%+1:UNTIL EOF#F%:CLOSE#F%:ENDPROC450DEFPROCstOb(O%,R%):LOCAL P%,L%:O%=O%-1:P%=(O%*8)+4:?(OB%+P%)=R% DIV 256:?(OB%+P%+1)=R% MOD 256:ENDPROC460DEFPROClsOb(R%,MS%):LOCAL X%,O%:O%=0:IF OBJN%=0 THEN ENDPROC470FOR X%=1TOOBJN%:M%=FNobHr(X%,R%):IF M%>0 THEN O%=O%+1:NEXT ELSE NEXT480IF O%=0 AND MS%>1 THEN PRINT:ENDPROC490IF O%=0 AND MS%=1 THEN PROCmsg(1):PROCmsg(18):ENDPROC500PRINT:IF MS%>0 THEN PROCmsg(MS%):PRINT510FOR X%=1TOOBJN%:M%=FNobHr(X%,R%):IF M%>0 THEN PRINTCHR$(131);:PROCmsg(M%):PRINT:NEXT ELSE NEXT520ENDPROC530DEFFNobHr(O%,R%):LOCAL P%,L%:O%=O%-1:L%=FNobLn(O%+1):IF L%=R% THEN =FNobMn(O%+1) ELSE =0540DEFFNobLn(O%):O%=O%-1:U%=(O%*8)+4+OB%:=?(U%)*256+?(U%+1)550DEFFNobMn(O%):O%=O%-1:U%=(O%*8)+2+OB%:=?(U%)*256+?(U%+1)560DEFFNobWt(O%):O%=O%-1:U%=(O%*8)+6+OB%:=?(U%)570DEFFNckMv:LOCAL LB%,HB%,N%:D%=FALSE:N%=?W%:IF N%=0 THEN =FALSE580FOR C%=1 TO (N%*3) STEP 3:IF ?(W%+C%)=V% THEN LB%=?(W%+C%+2):HB%=?(W%+C%+1):R%=HB%*256+LB%:D%=TRUE:NEXT ELSE NEXT590=D%600ENDPROC610DEFPROCgtRm(R%):LOCAL F%,N%,LB%,HB%,M%,D%:D%=0:IF FNon(1) AND FNon(2)=FALSE THEN D%=1:PROCmsg(13)620CL%=0:G%=VPOS:F%=OPENIN("DATA-R"):PTR#F%=FNrdIx(R%,"IDX-R"):N%=BGET#F%:FOR C%=1TON%:HB%=BGET#F%:LB%=BGET#F%:M%=FNcint(LB%,HB%):IF D%=0 THEN PROCmsg(!M%):NEXT ELSE NEXT630N%=BGET#F%:?W%=N%:FOR C%=1 TO 36:?(W%+C%)=0:NEXT:IF N%>0 THEN FOR C%=1 TO N%*3:?(W%+C%)=BGET#F%:NEXT640CLOSE#F%:IF D%=0 THEN PROClsOb(R%,15)650PROCrmMsg:ENDPROC660DEFFNcint(LB%,HB%):?CI%=LB%:?(CI%+1)=HB%:?(CI%+2)=0:?(CI%+3)=0:=CI%670DEFPROCgW(T%):LOCAL N%,R%,D$,RN%:R%=1680IF T%=1 THEN N%=OPENIN("DATA-N") ELSE IF T%=2 THEN N%=OPENIN("DATA-V") ELSE IF T%=4 THEN N%=OPENIN("DATA-A")690REPEAT:RN%=BGET#N%:INPUT#N%,D$:R%=R%+1:UNTIL EOF#N%:PTR#N%=0700IF T%=1 THEN NM%=R%:DIM N$(R%):DIM NN% R% ELSE IF T%=2 THEN VM%=R%:DIM V$(R%):DIM VN% R% ELSE IF T%=4 THEN AM%=R%:DIM A$(R%):DIM AN% R%710R%=1:REPEAT:RN%=BGET#N%:INPUT#N%,D$720IF T%=1 THEN N$(R%)=FNtU(D$):NN%?R%=RN% ELSE IF T%=2 THEN V$(R%)=FNtU(D$):VN%?R%=RN% ELSE IF T%=4 THEN A$(R%)=FNtU(D$):AN%?R%=RN%730R%=R%+1:PRINT".";:UNTIL EOF#N%:CLOSE#N%:ENDPROC740DEFPROCmsg(M%):LOCAL S%,P%,H%,M$,A%:M$=MS$(M%)750IF M%=0 THEN PRINT760S%=1:P%=1:H%=POS:REPEAT:P%=INSTR(M$," ",S%):IF P%=0 THEN H%=H%+(LEN(M$)-S%)+1 ELSE H%=H%+(P%-S%)+1770IF H%>40 THEN PRINT780PRINT MID$(M$,S%,P%-S%);" ";:H%=POS:S%=P%+1:790UNTIL P%=0800IF POS=1 THEN VDU31,POS-1,VPOS:A%=135:C=USR(&FFF4):C=C AND &FFFF:C=C DIV &100:IF C>32 THEN VDU31,POS+1,VPOS810ENDPROC820DEFFNrdIx(Re%,file$):I%=(Re%-1)*5:IND=OPENIN(file$):PTR#IND=I%:INPUT#IND,I%:CLOSE#IND:=I%830DEFPROCpsTxt:LOCAL WRDLEN%,C$,C%,S%,U%:PROCvars:REPEAT:PRINT:PROCmsg(2):U%=VPOS:INPUT TAB(LEN(MS$(2)),U%), CMD$:UNTIL CMD$>"":TIME=0:CMD$=FNtU(CMD$):S%=1:IF CMD$="*." THEN D%=TRUE:*CAT840IF CMD$="*C" THEN PROCshowC:D%=TRUE850IF LEFT$(CMD$,4)="*WON" THEN SW%=1:D%=TRUE860IF LEFT$(CMD$,5)="*WOFF" THEN SW%=0:D%=TRUE870IF LEFT$(CMD$,4)="*CON" THEN SC%=1:D%=TRUE880IF LEFT$(CMD$,5)="*COFF" THEN SC%=0:D%=TRUE890REPEAT:WRD$=FNgW(MID$(CMD$,S%,LEN(CMD$)-S%+1)):S%=S%+LEN(WRD$)+1:IF WRD$="IT" THEN N%=L%:C%=1900IF V%=0 THEN V%=FNpW(WRD$,1):IF V%>0 THEN C%=1910IF C%=0 THEN IF N%=0 THEN N%=FNpW(WRD$,2):IF N%>0 THEN C%=1:L%=N%920IF C%=0 THEN IF AVRB%=0 THEN AVRB%=FNpW(WRD$,3):IF AVRB%>0 THEN C%=1930IF C%=0 THEN IF NO2%=0 THEN NO2%=FNpW(WRD$,2):IF NO2%=N% THEN NO2%=0940C%=0:UNTIL S%>=LEN(CMD$)950IF SW%=1 PROCshowParse960ENDPROC970DEFFNpW(T$,T%):LOCAL W%,N%,E%,F%,R%,W$,M%:W%=0:R%=1:E%=LEN(T$)980REPEAT:IF T%=1 THEN W$=V$(R%):M%=VM% ELSE IF T%=2 THEN W$=N$(R%):M%=NM% ELSE IF T%=3 THEN W$=A$(R%):M%=AM%990F%=LEN(W$):IF E%>=F% THEN IF T$=W$ AND F%>0 THEN W%=R%1000R%=R%+1:UNTIL R%=M% OR W%>0 OR F%=01010IF T%=1 AND W%>0 THEN =VN%?W% ELSE IF T%=2 AND W%>0 THEN =NN%?W% ELSE IF T%=3 AND W%>0 THEN =AN%?W% ELSE =01020DEFFNtU(T$):LOCAL C%,P%,L%,U$:U$="":L%=LEN(T$):FOR P%=1 TO L%:C%=ASC(MID$(T$,P%,1)):IF C%>90 THEN C%=C%-321030U$=U$+CHR$(C%):NEXT:=U$1040DEFFNgW(T$):LOCAL C%,C$,WRD$:C%=11050REPEAT:C$=MID$(T$,C%,1):WRD$=WRD$+C$:C%=C%+1:UNTIL C$=" " OR C%>LEN(T$)1060IF RIGHT$(WRD$,1)<>" " THEN WRD$=WRD$+" "1070=LEFT$(WRD$,LEN(WRD$)-1)1080DEFPROCvars:CMD$="":N%=0:NO2%=0:V%=0:AVRB%=0:OBJ%=0:WRD$="":N%=0:D%=0:ENDPROC1090DEFPROCtake(O%):IF FNobHr(O%,R%)=0 THEN PROCmsg(14):ENDPROC1100IF CW%+FNobWt(O%)>ENC% THEN PROCmsg(10):ENDPROC1110PROCstOb(O%,PL%):PROCmsg(16):PROCt:CW%=CW%+FNobWt(O%):ENDPROC1120DEFPROCswap(O1%,O2%):PROCstOb(O1%,0):PROCstOb(O2%,PL%):ENDPROC1130DEFPROCmove(O%,R%):PROCstOb(O%,R%):ENDPROC1140DEFPROCdrop(O%):IF FNobHr(O%,PL%)=0:PROCmsg(8):ENDPROC1150PROCstOb(O%,R%):PROCmsg(16):PROCt:CW%=CW%-FNobWt(O%):ENDPROC1160DEFPROCinv:PROClsOb(PL%,1):ENDPROC1170DEFPROCobj(O%):PROCmsg(FNobMn(O%)):ENDPROC1180DEFPROClist(R%):PROClsOb(R%,0):ENDPROC1190DEFPROCgoto(RM%):R%=RM%:ENDPROC1200DEFPROCfind(O%):LOCAL T%:T%=FNobLn(O%):PROCgoto(T%):ENDPROC1210DEFPROCt:T%=T%+1:ENDPROC1220DEFPROCenc(D%):ENC%=D%:ENDPROC1230DEFFNon(F%):IF ?(CTR%+F%)>0 THEN =TRUE ELSE =FALSE1240DEFPROCinc(C%):LOCAL T%:T%=FNget(C%):IF T%<256 THEN T%=T%+1:PROCset(C%,T%)1250ENDPROC1260DEFPROCdec(C%):LOCAL T%:T%=FNget(C%):IF T%>0 THEN T%=T%-1:PROCset(C%,T%)1270ENDPROC1280DEFPROChold(T%):LOCAL FT%:FT%=TIME+T%:REPEAT:UNTIL TIME>=FT%:ENDPROC1290DEFPROCset(C%,T%):?(CTR%+C%)=T%:ENDPROC1300DEFPROCon(C%):?(CTR%+C%)=1:ENDPROC1310DEFPROCoff(C%):?(CTR%+C%)=0:ENDPROC1320DEFFNget(C%):=?(CTR%+C%)1330DEFPROCcls(S%):Q%=S%:PROCe:PROCmsg(16):ENDPROC1340DEFFNhere(O%):IF FNobHr(O%,R%)=0 THEN =FALSE ELSE =TRUE1350DEFFNinInv(O%):IF FNobHr(O%,PL%)=0 THEN =FALSE ELSE =TRUE1360DEFFNavail(O%)=FNhere(O%) OR FNinInv(O%)1370DEFFNrn(N%):LOCAL R%:R%=RND(N%):=R%1380DEFPROCe:D%=1:ENDPROC1390DEFPROCexit:EX%=1:ENDPROC1400DEFFNturn:=T%1410DEFPROCwait:PRINT:PRINT"Please press a key.";:REPEAT UNTIL INKEY(0)<>-1:ENDPROC1420DEFPROCinit1430PROCset(5,1):PROCset(3,3):PROCenc(111)1440ENDPROC1450DEFPROCpreRoom1460PROCset(1,0)1470IF R%=2 OR R%=3 OR R%=6 THEN PROCset(1,1)1480ENDPROC1490DEFPROCrmMsg1500ENDPROC1510DEFFNhighPty1520IF FNon(1) AND NOT FNon(2) THEN PROCdec(3)1530IF FNon(1) AND NOT FNon(2) AND FNget(3)=1 THEN PROCmsg(30)1540IF FNon(1) AND NOT FNon(2) AND FNget(3)=0 THEN PROChold(50):PROCmsg(31):PROCexit:=TRUE1550IF R%=3 THEN IF NOT FNavail(2) AND NOT FNon(4) THEN PROChold(50):PROCmsg(32):PROCexit:=TRUE1560IF R%=3 THEN IF FNavail(2) AND NOT FNon(4) THEN PROChold(50):PROCmsg(33):PROCset(4,1):PROCmove(2,0):CW%=CW%-20:=TRUE1570IF R%=1 THEN IF FNavail(4):PROCmsg(34):PROCexit:=TRUE1580=FALSE1590DEFFNlowPty1600IF V%=17 THEN IF N%=8 THEN PROCcls(1):=TRUE1610IF V%=18 THEN IF N%=8 THEN PROCcls(0):=TRUE1620IF V%=14 THEN PROCsave:=TRUE1630IF V%=22 THEN PROCload:=TRUE1640IF R%=3 THEN IF V%=7 AND N%=5 THEN PROCmsg(32):PROCexit:=TRUE1650IF R%=3 THEN IF V%=2 THEN PROCmsg(35):PROCexit:=TRUE1660IF R%=4 THEN IF V%=16 AND N%=7 AND NOT FNon(6) THEN PROCset(6,1):PROCmsg(36):PROCmove(3,4):=TRUE1670IF R%=5 THEN IF V%=19 AND FNavail(3) AND N%=6 AND NOT FNon(7):PROCset(7,1):PROCmsg(37):=TRUE1680IF R%=5 THEN IF V%=3 AND FNon(7) THEN:PROCgoto(6):=TRUE1690IF V%=16 THEN PROCmsg(38):=TRUE1700IF V%=17 AND N%=1 THEN IF FNinInv(1) THEN PROCswap(1,5):PROCset(2,1):PROCmsg(39):=TRUE1710IF V%=18 AND N%=1 THEN IF FNinInv(5) THEN PROCswap(5,1):PROCset(2,0):PROCmsg(40):=TRUE1720IF V%=9 THEN PROCgtRm(R%):=TRUE1730IF V%=8 THEN IF N%=1 THEN IF FNinInv(5) THEN PROCdrop(5):PROCset(2,0):=TRUE1740IF V%=7 THEN IF N%=1 THEN IF FNhere(5) THEN PROCtake(5):PROCset(2,1):=TRUE1750IF V%=7 THEN IF N%<5 THEN PROCtake(N%):=TRUE1760IF V%=8 THEN IF N%<5 THEN PROCdrop(N%):=TRUE1770IF V%=10 THEN PROCinv:=TRUE1780=FALSE